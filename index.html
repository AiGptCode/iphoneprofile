<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Configuration Profile Generator</title>
  <!-- Add Bootstrap CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+Knujsl7/1L_dstPt3HV5HzF6Gvk/e3s4Wz6iJgD/+ub3o" crossorigin="anonymous">
  <!-- Add custom CSS styles -->
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(to right, #333, #555);
      color: #fff;
    }
    .container {
      max-width: 800px;
      margin-top: 50px;
      padding: 30px;
      background-color: rgba(0, 0, 0, 0.6);
      border-radius: 10px;
      box-shadow: 0px 0px 20px rgba(0,0,0,0.5);
    }
    h1 {
      text-align: center;
      margin-bottom: 50px;
      color: #fff;
      font-weight: 300;
      text-shadow: 2px 2px #000;
    }
    label {
      font-weight: 500;
      display: block;
      margin-bottom: 5px;
      position: relative;
    }
    label::before {
      content: '';
      position: absolute;
      left: 0;
      bottom: 0;
      width: 100%;
      height: 2px;
      background-color: #fff;
      transform: scaleX(0);
      transition: transform 0.3s ease-out;
    }
    label:hover::before, input:focus + label::before, select:focus + label::before, textarea:focus + label::before {
      transform: scaleX(1);
    }
    .form-text {
      color: #888;
      margin-top: 5px;
    }
    .carrier {
      color: #f00;
    }
    .apn {
      color: #f90;
    }
    .vpn {
      color: #09f;
    }
    .proxy {
      color: #0f0;
    }
    .dns {
      color: #00f;
    }
    .cloudflare {
      color: #f0f;
    }
    input, select, textarea {
      border-radius: 10px;
      box-shadow: 0px 0px 5px rgba(0,0,0,0.5);
      padding: 10px;
      font-size: 14px;
      background-color: rgba(0, 0, 0, 0.3);
      color: #fff;
      border: none;
      margin-bottom: 20px;
    }
    button {
      background-color: #f00;
      color: #fff;
      border-radius: 10px;
      padding: 10px 20px;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
      font-size: 14px;
      font-weight: 500;
      margin-top: 20px;
      display: block;
      width: 50%;
      margin-left: auto;
      margin-right: auto;
    }
    button:hover {
      background-color: #f30;
    }
    /* Add responsive styles for mobile devices */
    @media only screen and (max-width: 600px) {
      .container {
        padding: 20px;
      }
      h1 {
        font-size: 24px;
      }
      label {
        font-size: 14px;
      }
      input, select, textarea {
        font-size: 14px;
      }
      button {
        font-size: 14px;
      }
    }
  </style>
  <!-- Add custom fonts from Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h1>Configuration Profile Generator</h1>
    <!-- Add form for configuration generator -->
    <form id="config-form">
      <!-- APN -->
      <div class="mb-3">
        <label for="apn" class="form-label apn">APN:</label>
        <div id="apn-inputs">
          <input type="text" id="apn" class="form-control" value="mtnirancell">
          <div class="form-text">Enter the APN (Access Point Name) for your carrier. The default value is "mtnirancell".</div>
        </div>
      </div>

      <!-- VPN -->
      <div class="mb-3">
        <label for="vpn_server" class="form-label vpn">VPN Server (optional):</label>
        <div id="vpn-inputs">
          <input type="text" id="vpn_server" class="form-control">
          <div class="form-text">Enter the hostname or IP address of your VPN server if you want to use a VPN connection. Leave this field blank if you don't want to use a VPN.</div>

          <label for="vpn_username" class="form-label vpn">VPN Username (optional):</label>
          <input type="text" id="vpn_username" class="form-control">
          <div class="form-text">Enter your VPN username if you want to use a VPN connection. Leave this field blank if you don't want to use a VPN.</div>

          <label for="vpn_password" class="form-label vpn">VPN Password (optional):</label>
          <input type="password" id="vpn_password" class="form-control">
          <div class="form-text">Enter your VPN password if you want to use a VPN connection. Leave this field blank if you don't want to use a VPN.</div>
        </div>
        <div class="form-check">
          <input type="checkbox" id="vpn-toggle" class="form-check-input">
          <label for="vpn-toggle" class="form-check-label">Include VPN in profile</label>
        </div>
      </div>

      <!-- Proxy -->
      <div class="mb-3">
        <label for="proxy_server" class="form-label proxy">Proxy Server (optional):</label>
        <div id="proxy-inputs">
          <input type="text" id="proxy_server" class="form-control">
          <div class="form-text">Enter the hostname or IP address of your proxy server if you want to use a proxy connection. Leave this field blank if you don't want to use a proxy.</div>

          <label for="proxy_port" class="form-label proxy">Proxy Port (optional):</label>
          <input type="text" id="proxy_port" class="form-control">
          <div class="form-text">Enter the port number of your proxy server if you want to use a proxy connection. Leave this field blank if you don't want to use a proxy.</div>
        </div>
        <div class="form-check">
          <input type="checkbox" id="proxy-toggle" class="form-check-input">
          <label for="proxy-toggle" class="form-check-label">Include Proxy in profile</label>
        </div>
      </div>

      <!-- Firewall -->
      <div class="mb-3 form-check">
        <input type="checkbox" id="firewall-toggle" class="form-check-input">
        <label for="firewall-toggle" class="form-check-label">Include Firewall in profile</label>
      </div>

      <button type="submit" class="btn btn-primary">Generate Configuration Profile</button>
    </form>
  </div>

  <!-- Add Bootstrap JS CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz4fnFO9gybBud7TlRbs/ic4AwGcFZOxg5DpPt8EgeUIgIwzjWfXQKWA4" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-cn7l7gDp0eyniUwwAZgrzD06kc/tftFf19TOAs2zVinnD/C7E91j9yyk5//jjpt/" crossorigin="anonymous"></script>

  <!-- Add custom JavaScript -->
  <script>
    const configForm = document.getElementById('config-form');

    function handleFormSubmit(event) {
      event.preventDefault();

      // Collect form data
      const formElements = configForm.elements;
      const formData = {};
      for (const element of formElements) {
        if (element.name && element.type !== 'checkbox') {
          formData[element.name] = element.value;
        } else if (element.name && element.type === 'checkbox' && element.checked) {
          formData[element.name] = element.value;
        }
      }

      // Create the configuration profile dictionary
      const configDict = {
        "PayloadContent": [],
        "PayloadDisplayName": "Cellular and Network Settings",
        "PayloadIdentifier": "com.example.cellular",
        "PayloadOrganization": "Example Inc.",
        "PayloadRemovalDisallowed": false,
        "PayloadType": "Configuration",
        "PayloadUUID": uuidv4(),
        "PayloadVersion": 1
      };

      // Create the cellular payload dictionary
      const cellularDict = {
        "PayloadDisplayName": "Cellular",
        "PayloadIdentifier": uuidv4(),
        "PayloadType": "com.apple.cellular",
        "PayloadUUID": uuidv4(),
        "PayloadVersion": 1,
        "APNs": [
          {
            "AuthenticationType": "CHAP",
            "Enabled": true,
            "Name": formData.apn || "mtnirancell"
          }
        ],
        "SignalBoostEnabled": true
      };

      // Add the cellular payload to the configuration profile
      configDict["PayloadContent"].push(cellularDict);

      // Create the VPN payload dictionary if VPN server is provided and VPN is enabled
      const vpnServer = formData.vpn_server || '';
      const vpnEnabled = formData['vpn-toggle'] !== null;
      if (vpnEnabled && vpnServer) {
        const vpnDict = {
          "PayloadDisplayName": "VPN",
          "PayloadIdentifier": uuidv4(),
          "PayloadType": "com.apple.vpn.managed",
          "PayloadUUID": uuidv4(),
          "PayloadVersion": 1,
          "AuthenticationMethod": "Certificate",
          "DisconnectOnLogout": true,
          "DisconnectOnSleep": true,
          "SendAllTraffic": true,
          "ServerAddress": vpnServer,
          "ServerPort": 1723,
          "Protocol": "L2TP",
          "SharedSecret": "YourSharedSecret",
          "Username": formData.vpn_username || "YourUsername",
          "Password": formData.vpn_password || "YourPassword"
        };

        // Add the VPN payload to the configuration profile
        configDict["PayloadContent"].push(vpnDict);
      }

      // Create the proxy payload dictionary if proxy server and port are provided and proxy is enabled
      const proxyServer = formData.proxy_server || '';
      const proxyPort = formData.proxy_port || '';
      const proxyEnabled = formData['proxy-toggle'] !== null;
      if (proxyEnabled && proxyServer && proxyPort) {
        const proxyDict = {
          "PayloadDisplayName": "Proxy",
          "PayloadIdentifier": uuidv4(),
          "PayloadType": "com.apple.proxy",
          "PayloadUUID": uuidv4(),
          "PayloadVersion": 1,
          "HTTPEnable": true,
          "HTTPPort": parseInt(proxyPort),
          "HTTPSEnable": true,
          "HTTPSPort": parseInt(proxyPort),
          "FTPEnable": true,
          "FTPPort": 21,
          "SOCKSEnable": true,
          "SOCKSPort": 1080,
          "Server": proxyServer,
          "ExclusionList": ["localhost", "127.0.0.1", "169.254.0.0/16"]
        };

        // Add the proxy payload to the configuration profile
        configDict["PayloadContent"].push(proxyDict);
      }

      // Create the firewall payload dictionary if firewall is enabled
      const firewallEnabled = formData['firewall-toggle'] !== null;
      if (firewallEnabled) {
        const firewallDict = {
          "PayloadDisplayName": "Firewall",
          "PayloadIdentifier": uuidv4(),
          "PayloadType": "com.apple.firewall",
          "PayloadUUID": uuidv4(),
          "PayloadVersion": 1,
          "Enabled": true,
          "AllowedApplications": ["com.apple.Safari", "com.apple.Mail", "com.apple.Messages", "com.apple.iChat"],
          "AllowedServices": ["com.apple.netbios", "com.apple.ssh"],
          "StealthMode": true
        };

        // Add the firewall payload to the configuration profile
        configDict["PayloadContent"].push(firewallDict);
      }

      // Convert the configuration dictionary to a plist string
      const configPlist = plistToXml(configDict);

      // Create a Blob object from the configuration profile string
      const configBlob = new Blob([configPlist], { type: 'application/x-apple-config' });

      // Create a download link and click it to download the file
      const downloadLink = document.createElement('a');
      downloadLink.href = URL.createObjectURL(configBlob);
      downloadLink.download = 'config.mobileconfig';
      downloadLink.click();

      // Wait for the download to complete before revoking the object URL
      setTimeout(() => {
        URL.revokeObjectURL(downloadLink.href);
      }, 1000);
    }

    function uuidv4() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    // Function to convert a JavaScript object (JSON) to an XML-based plist string
    function plistToXml(obj, indent = '', isArray = false) {
      let result = '';
      if (isArray) {
        result += indent + '<array>\n';
      } else {
        result += indent + '<dict>\n';
      }
      for (const key in obj) {
        const value = obj[key];
        const newIndent = indent + '  ';
        if (typeof value === 'object' && value !== null) {
          if (Array.isArray(value)) {
            result += plistToXml(value, newIndent, true);
          } else {
            result += newIndent + '<key>' + key + '</key>\n';
            result += plistToXml(value, newIndent);
          }
        } else if (typeof value === 'boolean') {
          result += newIndent + '<key>' + key + '</key><' + (value ? 'true' : 'false') + '/>\n';
        } else if (typeof value === 'number' && !isNaN(value)) {
          result += newIndent + '<key>' + key + '</key><integer>' + value + '</integer>\n';
        } else {
          result += newIndent + '<key>' + key + '</key><string>' + value + '</string>\n';
        }
      }
      if (isArray) {
        result += indent + '</array>\n';
      } else {
        result += indent + '</dict>\n';
      }

      // Add the XML declaration, DOCTYPE, and plist root element if this is the top-level object
      if (indent === '') {
        result = '<?xml version="1.0" encoding="UTF-8"?>'\n +
                 '<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">'\n +
                 '<plist version="1.0">' + result + '</plist>';
      }

      return result;
    }

    configForm.addEventListener('submit', handleFormSubmit);
  </script>
</body>
</html>
