<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Configuration Profile Generator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Add your custom CSS styles here */
  </style>
</head>
<body>
  <div class="container mt-5">
    <h1>Configuration Profile Generator</h1>
    <form id="config-form">
      <!-- APN -->
      <div class="mb-3">
        <label for="apn" class="form-label">APN:</label>
        <select id="apn" class="form-select">
          <option value="">Automatic</option>
          <option value="mcinet" data-carrier="mcinet">MCI</option>
          <option value="irancell" data-carrier="irancell">Irancell</option>
          <option value="rightel" data-carrier="rightel">RighTel</option>
        </select>
      </div>

      <!-- VPN -->
      <div class="mb-3">
        <label for="vpn_server" class="form-label">VPN Server:</label>
        <input type="text" id="vpn_server" class="form-control" value="vpn.example.com">
      </div>
      <div class="mb-3">
        <label for="vpn_username" class="form-label">VPN Username:</label>
        <input type="text" id="vpn_username" class="form-control" value="YourUsername">
      </div>
      <div class="mb-3">
        <label for="vpn_shared_secret" class="form-label">VPN Shared Secret:</label>
        <input type="text" id="vpn_shared_secret" class="form-control" value="YourSharedSecret">
      </div>

      <!-- Proxy -->
      <div class="mb-3">
        <label for="proxy_server" class="form-label">Proxy Server:</label>
        <input type="text" id="proxy_server" class="form-control" value="proxy.example.com">
      </div>
      <div class="mb-3">
        <label for="http_port" class="form-label">HTTP Port:</label>
        <input type="number" id="http_port" class="form-control" value="8080">
      </div>
      <div class="mb-3">
        <label for="https_port" class="form-label">HTTPS Port:</label>
        <input type="number" id="https_port" class="form-control" value="8080">
      </div>
      <div class="mb-3">
        <label for="ftp_port" class="form-label">FTP Port:</label>
        <input type="number" id="ftp_port" class="form-control" value="21">
      </div>
      <div class="mb-3">
        <label for="socks_port" class="form-label">SOCKS Port:</label>
        <input type="number" id="socks_port" class="form-control" value="1080">
      </div>

      <!-- Firewall -->
      <div class="mb-3">
        <label for="allowed_applications" class="form-label">Allowed Applications (comma-separated):</label>
        <input type="text" id="allowed_applications" class="form-control" value="com.apple.Safari,com.apple.Mail,com.apple.Messages,com.apple.iChat">
      </div>
      <div class="mb-3">
        <label for="allowed_services" class="form-label">Allowed Services (comma-separated):</label>
        <input type="text" id="allowed_services" class="form-control" value="com.apple.netbios,com.apple.ssh">
      </div>

      <button type="submit" class="btn btn-primary">Generate Configuration Profile</button>
    </form>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
  <script>
    // Function to generate a random UUID
    function generateUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    document.getElementById('config-form').addEventListener('submit', function(event) {
      event.preventDefault();

      // Parse form data
      const apnSelect = document.getElementById('apn');
      const apnValue = apnSelect.value || apnSelect.options[apnSelect.selectedIndex].dataset.carrier;

      const formData = new FormData(event.target);
      const plistData = {
        PayloadContent: [
          {
            PayloadDisplayName: "Cellular",
            PayloadIdentifier: "com.apple.cellular",
            PayloadType: "com.apple.cellular",
            PayloadUUID: generateUUID(), // Generate a unique UUID
            PayloadVersion: 1,
            APNs: [
              {
                AuthenticationType: "CHAP",
                Enabled: true,
                Name: apnValue,
              }
            ],
            SignalBoostEnabled: true,
            VPN: {
              Enabled: true,
              PayloadType: "com.apple.vpn",
              PayloadUUID: generateUUID(), // Generate a unique UUID
              PayloadVersion: 1,
              OnDemandEnabled: true,
              PayloadContent: [
                {
                  PayloadDisplayName: "VPN Configuration",
                  PayloadIdentifier: "com.apple.vpn.managed",
                  PayloadType: "com.apple.vpn.managed",
                  PayloadUUID: generateUUID(), // Generate a unique UUID
                  PayloadVersion: 1,
                  AuthenticationMethod: "Certificate",
                  DisconnectOnLogout: true,
                  DisconnectOnSleep: true,
                  SendAllTraffic: true,
                  ServerAddress: formData.get('vpn_server'),
                  ServerPort: 1723,
                  Protocol: "L2TP",
                  SharedSecret: formData.get('vpn_shared_secret'),
                  Username: formData.get('vpn_username'),
                }
              ]
            },
            Proxy: {
              Enabled: true,
              PayloadType: "com.apple.proxy",
              PayloadUUID: generateUUID(), // Generate a unique UUID
              PayloadVersion: 1,
              HTTPEnable: true,
              HTTPPort: parseInt(formData.get('http_port')), 10),
              HTTPSEnable: true,
              HTTPSPort: parseInt(formData.get('https_port')), 10),
              FTPEnable: true,
              FTPPort: parseInt(formData.get('ftp_port')), 10),
              SOCKSEnable: true,
              SOCKSPort: parseInt(formData.get('socks_port')), 10),
              Server: formData.get('proxy_server'),
              ExclusionList: ["localhost", "127.0.0.1", "169.254.0.0/16"],
            },
            Firewall: {
              Enabled: true,
              PayloadType: "com.apple.firewall",
              PayloadUUID: generateUUID(), // Generate a unique UUID
              PayloadVersion: 1,
              AllowedApplications: formData.get('allowed_applications').split(','),
              AllowedServices: formData.get('allowed_services').split(','),
              StealthMode: true,
            }
          }
        ],
        PayloadDisplayName: "Cellular and Network Settings",
        PayloadIdentifier: "com.example.cellular",
        PayloadOrganization: "Example Inc.",
        PayloadRemovalDisallowed: false,
        PayloadType: "Configuration",
        PayloadUUID: generateUUID(), // Generate a unique UUID
        PayloadVersion: 1
      };

      // Convert plistData to XML
      const plistXml = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
  ${Object.keys(plistData).map(key => `
    <key>${key}</key>
    ${typeof plistData[key] === 'object' ? serializeObject(plistData[key]) : `
    <${typeof plistData[key] === 'number' ? 'integer' : 'string'}>${plistData[key]}</${typeof plistData[key] === 'number' ? 'integer' : 'string'}>
    `}`}
  `).join('')}
  </dict>
</plist>`;

      // Download plistXml as a file
      const blob = new Blob([plistXml], { type: 'text/xml' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'config.plist';
      a.click();

      function serializeObject(obj) {
        if (Array.isArray(obj)) {
          return `
    <array>
      ${obj.map(item => serializeObject(item)).join('')}
      </array>
    `;
        }

        return `
    <dict>
      ${Object.keys(obj).map(key => `
        <key>${key}</key>
        ${typeof obj[key] === 'object' ? serializeObject(obj[key]) : `
        <${typeof obj[key] === 'number' ? 'integer' : 'string'}>${obj[key]}</${typeof obj[key] === 'number' ? 'integer' : 'string'}>
        `}`}
      `).join('')}
      </dict>
    `;
      }
    });
  </script>
</body>
</html>
