<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Configuration Profile Generator</title>
  <!-- Add Bootstrap CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+Knujsl7/1L_dstPt3HV5HzF6Gvk/e3s4Wz6iJgD/+ub3o" crossorigin="anonymous">
  <!-- Add custom CSS styles -->
  <style>
    /* (Same as before) */
  </style>
  <!-- Add custom fonts from Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h1>Configuration Profile Generator</h1>
    <!-- Add form for configuration generator -->
    <form id="config-form">
      <!-- APN -->
      <div class="mb-3">
        <label for="apn" class="form-label apn">APN:</label>
        <div id="apn-inputs">
          <select id="apn" class="form-select">
            <option value="">Automatic</option>
            <option value="mcinet" data-carrier="mcinet">MCI</option>
            <option value="irancell" data-carrier="irancell">Irancell</option>
            <option value="rightel" data-carrier="rightel">RighTel</option>
            <option value="mtnirancell" data-carrier="mtnirancell">MTN Irancell</option>  <!-- Added option for mtnirancell -->
          </select>
          <div class="form-text">Select the APN (Access Point Name) for your carrier. The default option is "Automatic", which will automatically select the APN based on your carrier.</div>
        </div>
        <div class="form-check">
          <input type="checkbox" id="apn-toggle" class="form-check-input">
          <label for="apn-toggle" class="form-check-label">Include APN in profile</label>
        </div>
      </div>

      <!-- VPN -->
      <div class="mb-3">
        <label for="vpn_server" class="form-label vpn">VPN Server (optional):</label>
        <div id="vpn-inputs">
          <input type="text" id="vpn_server" class="form-control" value="vpn.example.com">  <!-- Updated default value -->
          <div class="form-text">Enter the hostname or IP address of your VPN server if you want to use a VPN connection. Leave this field blank if you don't want to use a VPN.</div>

          <label for="vpn_username" class="form-label vpn">VPN Username (optional):</label>
          <input type="text" id="vpn_username" class="form-control" value="YourUsername">  <!-- Updated default value -->
          <div class="form-text">Enter your VPN username if you want to use a VPN connection. Leave this field blank if you don't want to use a VPN.</div>

          <label for="vpn_password" class="form-label vpn">VPN Password (optional):</label>
          <input type="password" id="vpn_password" class="form-control">
          <div class="form-text">Enter your VPN password if you want to use a VPN connection. Leave this field blank if you don't want to use a VPN.</div>
        </div>
        <div class="form-check">
          <input type="checkbox" id="vpn-toggle" class="form-check-input">
          <label for="vpn-toggle" class="form-check-label">Include VPN in profile</label>
        </div>
      </div>

      <!-- Proxy -->
      <div class="mb-3">
        <label for="proxy_server" class="form-label proxy">Proxy Server (optional):</label>
        <div id="proxy-inputs">
          <input type="text" id="proxy_server" class="form-control" value="proxy.example.com">  <!-- Updated default value -->
          <div class="form-text">Enter the hostname or IP address of your proxy server if you want to use a proxy connection. Leave this field blank if you don't want to use a proxy.</div>

          <label for="proxy_port" class="form-label proxy">Proxy Port (optional):</label>
          <input type="text" id="proxy_port" class="form-control" value="8080">  <!-- Updated default value -->
          <div class="form-text">Enter the port number of your proxy server if you want to use a proxy connection. Leave this field blank if you don't want to use a proxy.</div>
        </div>
        <div class="form-check">
          <input type="checkbox" id="proxy-toggle" class="form-check-input">
          <label for="proxy-toggle" class="form-check-label">Include Proxy in profile</label>
        </div>
      </div>

      <button type="submit" class="btn btn-primary">Generate Configuration Profile</button>
    </form>
  </div>

  <!-- Add Bootstrap JS CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz4fnFO9gybBud7TlRbs/ic4AwGcFZOxg5DpPt8EgeUIgIwzjWfXQKWA4" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-cn7l7gDp0eyniUwwAZgrzD06kc/tftFf19TOAs2zVinnD/C7E91j9yyk5//jjpt/" crossorigin="anonymous"></script>

  <!-- Add custom JavaScript -->
  <script>
    const configForm = document.getElementById('config-form');
    const plistTemplate = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>PayloadContent</key>
    <array>
        <dict>
            <key>PayloadDisplayName</key>
            <string>Cellular</string>
            <key>PayloadIdentifier</key>
            <string>com.apple.cellular</string>
            <key>PayloadType</key>
            <string>com.apple.cellular</string>
            <key>PayloadUUID</key>
            <string>A1B2C3D4-E5F6-1234-5678-90ABCDEF0123</string>
            <key>PayloadVersion</key>
            <integer>1</integer>
            <key>APNs</key>
            <array>
                <dict>
                    <key>AuthenticationType</key>
                    <string>{{apnAuthType}}}</string>
                    <key>Enabled</key>
                    <true/>
                    <key>Name</key>
                    <string>{{apnName}}</string>
                </dict>
            </array>
            <key>SignalBoostEnabled</key>
            <true/>
            {{vpnConfig}}
            {{proxyConfig}}
        </dict>
    </array>
    <key>PayloadDisplayName</key>
    <string>Cellular and Network Settings</string>
    <key>PayloadIdentifier</key>
    <string>com.example.cellular</string>
    <key>PayloadOrganization</key>
    <string>Example Inc.</string>
    <key>PayloadRemovalDisallowed</key>
    <false/>
    <key>PayloadType</key>
    <string>Configuration</string>
    <key>PayloadUUID</key>
    <string>A1B2C3D4-E5F6-1234-5678-90ABCDEF0128</string>
    <key>PayloadVersion</key>
    <integer>1</integer>
</dict>
</plist>`;

    function handleFormSubmit(event) {
      event.preventDefault();

      // Collect form data
      const formElements = configForm.elements;
      const formData = {};
      for (const element of formElements) {
        if (element.name && element.type !== 'checkbox') {
          formData[element.name] = element.value;
        } else if (element.name && element.type === 'checkbox' && element.checked) {
          formData[element.name] = element.value;
        }
      }
      formData.apn_option = document.querySelector('select[id="apn"] option:checked').dataset.carrier;

      // Determine the APN to use based on the apn_option parameter
      let apnName = formData.apn || '';
      let apnAuthType = 'PAP';
      if (formData.apn_option === 'mcinet') {
        apnName = 'mcinet';
        apnAuthType = 'CHAP';
      } else if (formData.apn_option === 'irancell') {
        apnName = 'irancell';
      } else if (formData.apn_option === 'rightel') {
        apnName = 'right';
      } else if (formData.apn_option === 'mtnirancell') {  // Added condition for mtnirancell
        apnName = 'mtnirancell';
      }

      // Generate VPN configuration (optional)
      const vpnServer = formData.vpn_server || '';
      const vpnEnabled = formData['vpn-toggle'] !== null;
      let vpnConfig = '';
      if (vpnEnabled && vpnServer) {
        vpnConfig = `
            <key>VPN</key>
            <dict>
                <key>Enabled</key>
                <true/>
                <key>PayloadType</key>
                <string>com.apple.vpn</string>
                <key>PayloadUUID</key>
                <string>A1B2C3D4-E5F6-1234-5678-90ABCDEF0124</string>
                <key>PayloadVersion</key>
                <integer>1</integer>
                <key>OnDemandEnabled</key>
                <true/>
                <key>PayloadContent</key>
                <array>
                    <dict>
                        <key>PayloadDisplayName</key>
                        <string>VPN Configuration</string>
                        <key>PayloadIdentifier</key>
                        <string>com.apple.vpn.managed</string>
                        <key>PayloadType</key>
                        <string>com.apple.vpn.managed</string>
                        <key>PayloadUUID</key>
                        <string>A1B2C3D4-E5F6-1234-5678-90ABCDEF0125</string>
                        <key>PayloadVersion</key>
                        <integer>1</integer>
                        <key>AuthenticationMethod</key>
                        <string>Certificate</string>
                        <key>DisconnectOnLogout</key>
                        <true/>
                        <key>DisconnectOnSleep</key>
                        <true/>
                        <key>SendAllTraffic</key>
                        <true/>
                        <key>ServerAddress</key>
                        <string>{{vpnServer}}</string>
                        <key>ServerPort</key>
                        <integer>1723</integer>
                        <key>Protocol</key>
                        <string>L2TP</string>
                        <key>SharedSecret</key>
                        <string>YourSharedSecret</string>
                        <key>Username</key>
                        <string>{{vpnUsername}}</string>
                    </dict>
                </array>
            </dict>
        `.replace('{{vpnServer}}', vpnServer)
                  .replace('{{vpnUsername}}', formData.vpn_username || '');
      }

      // Generate Proxy configuration (optional)
      const proxyServer = formData.proxy_server || '';
      const proxyPort = formData.proxy_port || '';
      const proxyEnabled = formData['proxy-toggle'] !== null;
      let proxyConfig = '';
      if (proxyEnabled && proxyServer && proxyPort) {
        proxyConfig = `
            <key>Proxy</key>
            <dict>
                <key>Enabled</key>
                <true/>
                <key>PayloadType</key>
                <string>com.apple.proxy</string>
                <key>PayloadUUID</key>
                <string>A1B2C3D4-E5F6-1234-5678-90ABCDEF0126</string>
                <key>PayloadVersion</key>
                <integer>1</integer>
                <key>HTTPEnable</key>
                <true/>
                <key>HTTPPort</key>
                <integer>{{proxyPort}}</integer>
                <key>HTTPSEnable</key>
                <true/>
                <key>HTTPSPort</key>
                <integer>{{proxyPort}}</integer>
                <key>FTPEnable</key>
                <true/>
                <key>FTPPort</key>
                <integer>21</integer>
                <key>SOCKSEnable</key>
                <true/>
                <key>SOCKSPort</key>
                <integer>1080</integer>
                <key>Server</key>
                <string>{{proxyServer}}</string>
                <key>ExclusionList</key>
                <array>
                    <string>localhost</string>
                    <string>127.0.0.1</string>
                    <string>169.254.0.0/16</string>
                </array>
            </dict>
        `.replace('{{proxyPort}}', proxyPort)
                  .replace('{{proxyServer}}', proxyServer);
      }

      // Replace placeholders in the plist template with the collected form data
      const configProfile = plistTemplate.replace('{{apnAuthType}}', apnAuthType)
                                         .replace('{{apnName}}', apnName)
                                         .replace('{{vpnConfig}}', vpnConfig)
                                         .replace('{{proxyConfig}}', proxyConfig);

      // Create a Blob object from the configuration profile string
      const configBlob = new Blob([configProfile], { type: 'application/x-apple-config' });

      // Create a download link and click it to download the file
      const downloadLink = document.createElement('a');
      downloadLink.href = URL.createObjectURL(configBlob);
      downloadLink.download = 'config.mobileconfig';
      downloadLink.click();

      // Wait for the download to complete before revoking the object URL
      setTimeout(() => {
        URL.revokeObjectURL(downloadLink.href);
      }, 1000);
    }

    configForm.addEventListener('submit', handleFormSubmit);
  </script>
</body>
</html>
