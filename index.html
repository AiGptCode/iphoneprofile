<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Combination Lock</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.126.1/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/17.4.0/Tween.min.js"></script>
  <style>
    #lock-container {
      perspective: 1000px;
      perspective-origin: center;
      margin: 0 auto;
      width: 80%;
      text-align: center;
    }

    .circle {
      position: absolute;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background-color: white;
      border: 1px solid gray;
      transform-origin: center;
      transform: rotateX(-40deg);
      transition: transform 0.5s ease-in-out;
      box-shadow: 0px 10px 10px rgba(0, 0, 0, 0.2);
    }

    .active {
      transform: rotateX(-40deg) rotateY(90deg);
    }
  </style>
</head>
<body>
  <h1>Combination Lock</h1>
  <form id="lock-form">
    <div id="lock-container">
      <div class="circle"></div>
      <div class="circle"></div>
      <div class="circle"></div>
      <div class="circle"></div>
    </div>
    <div>
      <label for="combination">Set Combination:</label>
      <input type="text" id="combination" maxlength="4" pattern="[0-9]{4}">
      <button type="button" id="set-btn">Set Combination</button>
    </div>
    <button type="submit" id="submit-btn" disabled>Login</button>
  </form>
  <script>
    const circles = document.querySelectorAll(".circle");
    const submitBtn = document.querySelector("#submit-btn");
    const combinationInput = document.querySelector("#combination");
    const setBtn = document.querySelector("#set-btn");
    let password = "";
    let lockState = false;
    let currentCombination = "";

    submitBtn.disabled = true;

    function setPassword() {
      password = combinationInput.value;
      if (!password) {
        alert("Please enter a 4-digit combination.");
        return;
      }

      localStorage.setItem("password", password);
      location.reload();
    }

    function handleCombinationChange() {
      currentCombination = "";
      circles.forEach((circle) => {
        const circleIndex = Array.from(circles).indexOf(circle);
        const rotationDegree = circle.style.transform.replace("rotate(", "").replace(")", "");
        currentCombination += Math.round(rotationDegree / 90) +1;
      });

      if (currentCombination === password) {
        lockState = true;
        submitBtn.disabled = false;
        // Perform login action if combination is correct (e.g., send an AJAX request)
        // Example: fetch('/login', {method: 'POST', body: JSON.stringify({password: password})})
      } else {
        submitBtn.disabled = true;
      }
    }

    setBtn.addEventListener("click", setPassword);

    window.addEventListener("DOMContentLoaded", () => {
      const storedPassword = localStorage.getItem("password");
      if (storedPassword) {
        password = storedPassword;
      }

      circles.forEach((circle) => {
        circle.addEventListener("click", () => {
          circle.classList.toggle("active");
          handleCombinationChange();
        });
      });
    });
  </script>
</body>
</html>
